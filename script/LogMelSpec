import torchaudio
import torch

import torch.nn as nn
class LogMelSpec(nn.Module):
    """
    Log Mel Spectrogram module.
    """
    def __init__(self, sample_rate=8000, n_mels=128, win_length=160, hop_length=80):
        super(LogMelSpec, self).__init__()
        self.transform = torchaudio.transforms.MelSpectrogram(
            sample_rate=sample_rate, n_mels=n_mels, win_length=win_length, hop_length=hop_length
        )

    def forward(self, x):
        x = self.transform(x)  # Mel spectrogram
        x = torch.log(x + 1e-14)  # Logarithmic scale
        return x

def get_featurizer(sample_rate, n_feats=81):
   return LogMelSpec(sample_rate=sample_rate, n_mels=n_feats, win_length=160, hop_length=80)